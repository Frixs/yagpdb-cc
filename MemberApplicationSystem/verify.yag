{{/*
	Trigger Type: Reaction (Add only)

	Made by Frixs#8694

    ---
    Channel/User role restrictions (require): Administrator, Moderator, Officer
    Only run in the following channels: newcomers
*/}}

{{ $channel_log := 907636826947321867 }} {{/* log channel */}}
{{ $channel_welcome := 381193130726260737 }} {{/* channel to send welcome message to */}}
{{ $role_id := 323042921110568960 }} {{/* member role that is going to be given on application accept */}}

{{ $reaction_emoji_name_1 := "‚úÖ" }} {{/* accept/promote to member intreaction reaction */}}
{{ $reaction_emoji_name_2 := "‚ùé" }} {{/* reject the application interaction */}}
{{ $reaction_emoji_name_3 := "üü¢" }} {{/* mark the application as accepted */}}
{{ $reaction_emoji_name_4 := "üî¥" }} {{/* mark the application as rejected */}}

{{ if gt (len .Message.Embeds) 0 }}
    {{ $user := userArg (index .Message.Embeds 0).Description }}

    {{ if eq .Reaction.Emoji.Name $reaction_emoji_name_1 }}
        {{ giveRoleID $user.ID $role_id }}

        {{ $avatar := (joinStr "" "https://cdn.discordapp.com/avatars/" (toString $user.ID) "/" $user.Avatar ".png") }}
        {{ $embed := cembed  
            "description" (joinStr "" .User.Mention " **granted full access** to " $user.Mention "!" )
            "color" 16777215
            "author" (sdict "name" $user.String "icon_url" $avatar) 
            "timestamp" .ReactionMessage.Timestamp
        }}

        {{ sendMessage $channel_log $embed }}

        {{ deleteAllMessageReactions nil .Message.ID }}
        {{ addReactions $reaction_emoji_name_3 }}

        {{ $welcomeEmbed := cembed
            "title" "**Ahoj! ... a v√≠tej!**"
            "description" (joinStr "" $user.Mention ", s pln√Ωm opr√°vnƒõn√≠m jsou ti dve≈ôe nyn√≠ v≈°ude otev≈ôen√©!\nDouf√°me, ≈æe u n√°s v komunitƒõ nalezne≈° mnoho zaj√≠mav√©ho a tak√© nov√© p≈ô√°tele.")
            "color" 0
            "thumbnail" (sdict "url" "https://cdn3.emoji.gg/emojis/1463-wave.gif")
            "fields" (cslice 
                (sdict "name" "Voliteln√© role <a:_:1098011075280117840>" "value" "> Chce≈° upozornit, kdy≈æ bude tv√° obl√≠ben√° hra zrovna ve slevƒõ?\n> ... nebo si chce≈° zahr√°t textov√© RPG?\n> Potom si nezapome≈à prohl√©dnout <#908005311573532672>." "inline" false) 
                (sdict "name" "Moduly <a:_:1097917564232945735>" "value" "> Moduly n√°m pom√°haj√≠ vytvo≈ôit p≈ôehledn√© prost≈ôed√≠ bez spamu a d√°vaj√≠ ƒçlen≈Øm mo≈ænost zobrazovat jen takov√° t√©mata, kter√° je doopravdy zaj√≠maj√≠.\n> Pod√≠vej se do <#935592355749298216>, a pokud se chce≈° do takov√Ωch modul≈Ø p≈ôidat, nev√°hej!" "inline" false) 
                (sdict "name" "Mushroom.gg <a:_:1097917539729805543>" "value" "> Je≈°tƒõ jsi o [Mushroom.gg](https://mushroom.gg/faq) nesly≈°el?\n> Tak neztr√°cej ƒças! Pou≈æij <@656246645075345461> p≈ô√≠kaz **`/help`** nebo **`/login`** a zaƒçni z√≠sk√°vat odmƒõny ze sv√Ωch obl√≠ben√Ωch her!\n> P≈ô√≠padnƒõ v√≠ce p≈ô√≠kaz≈Ø je zde: https://discord.com/channels/322783694731608074/381403492574822400/382867478763667456." "inline" false) 
                (sdict "name" "Emoji & Soundboard <a:_:1097490282834043002>" "value" "> Server nab√≠z√≠ rozmanit√© nev√≠dan√© emoji a soundboard.\n> Tak√© se m≈Ø≈æe≈° p≈ôipojit https://discord.com/channels/322783694731608074/910523820371214458/1108215102257254452 na dal≈°√≠ soundboard roz≈°i≈ôuj√≠c√≠ servery!" "inline" false) 
            )
        }}

        {{ $welcome_msg := complexMessage "content" $user.Mention "embed" $welcomeEmbed }}
        {{ $welcome_msg_id := sendMessageRetID $channel_welcome $welcome_msg }}
        {{ deleteMessage $channel_welcome $welcome_msg_id 43200 }}
        
    {{ else if eq .Reaction.Emoji.Name $reaction_emoji_name_2 }}
        {{ deleteAllMessageReactions nil .Message.ID }}
        {{ addReactions $reaction_emoji_name_4 }}
    {{ end }}
{{ end }}